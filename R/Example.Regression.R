setwd("~/GitHub/stat440/R")
source("MultivariableRegression.R")

require(MASS)
D <- Boston
Y <- D[c("crim", "zn", "indus", "tax", "black", "lstat")]
X <- D[c("chas", "nox", "rm", "age", "dis", "rad", "ptratio", "medv")]

# One example using flat priors and df of 73

#Result <- lm.multivariable(100000,as.matrix(X),as.matrix(Y))

# Now that we have that, we can generate 95% credibility interval
#by generating lower and upper quantiles

apply(Result$B, c(1,2), quantile, probs = 0.025)

#        [,1]       [,2]        [,3]        [,4]       [,5]        [,6]
#[1,] -2.4726166 -5.8679744  0.09608906 -32.9824267 -11.281075 -1.55826198
#[2,] -6.9573162 -0.8674746 20.12296722 256.4240012  71.771290 12.86687197
#[3,]  0.6781378  1.6702512 -1.27047227  -2.1000956 -14.681060 -1.33368492
#[4,] -0.1553847 -0.4728362 -0.09345642  -1.6003269  -1.790386 -0.08581789
#[5,] -0.5264732  6.4092475 -0.97953076   0.1691556   8.454171  0.20377180
#[6,]  0.4767344  0.2930137  0.04739809  13.7503723  -5.358764 -0.03775675
#[7,] -0.1783143 -2.4605295  0.36683531   4.8444292  11.568813  0.34594612
#[8,] -0.2359186  0.1865307 -0.06683020  -1.3784741   3.828851 -0.31275303

apply(Result$B, c(1,2), quantile, probs = 0.975)
#          [,1]       [,2]        [,3]       [,4]       [,5]       [,6]
#[1,]  1.23005537  3.0281855  2.38564313   4.015556  35.343992  2.2987712
#[2,]  4.38696504 26.3870831 27.15237654 370.716817 213.885742 24.6638782
#[3,]  2.15970956  5.2094969 -0.35461696  12.693659   3.842477  0.1986968
#[4,]  0.25299883  0.5131117  0.16027636   2.474993   3.370447  0.3374899
#[5,] -0.04380559  7.5768624 -0.67862663   5.027720  14.598202  0.7109332
#[6,]  0.63084308  0.6644552  0.14276972  15.299609  -3.412688  0.1239872
#[7,] -0.04911195 -2.1502284  0.44578529   6.134446  13.188602  0.4797648
#[8,] -0.19998163  0.2726097 -0.04467733  -1.018740   4.279617 -0.2754563

# Likewise we can generate the intervals for V

apply(Result$V, c(1,2), quantile, probs = 0.025)
#        [,1]        [,2]        [,3]       [,4]       [,5]        [,6]
#[1,]  33.929213    3.572982  -2.8734031  -35.94742  -71.79034   1.3119148
#[2,]   3.572982  201.484879  -4.6415480  119.76413 -114.39604   2.4386847
#[3,]  -2.873403   -4.641548  11.6966058   73.61370  -32.95110  -0.5026867
#[4,] -35.947422  119.764128  73.6137027 3254.96522 -337.01431 -13.0942620
#[5,] -71.790337 -114.396039 -32.9510957 -337.01431 5127.69941 -24.1551878
#[6,]   1.311915    2.438685  -0.5026867  -13.09426  -24.15519  13.8606121
apply(Result$V, c(1,2), quantile, probs = 0.975)
#[,1]       [,2]        [,3]       [,4]        [,5]      [,6]
#[1,] 42.8448517  19.031231   0.8469221   26.32315    6.156278  5.394610
#[2,] 19.0312313 254.479476   4.3884423  273.79120   74.709301 12.389779
#[3,]  0.8469221   4.388442  14.7900251  112.99105   12.895214  1.861531
#[4,] 26.3231463 273.791203 112.9910503 4111.03012  424.611619 26.220897
#[5,]  6.1562782  74.709301  12.8952138  424.61162 6468.929288 25.610153
#[6,]  5.3946102  12.389779   1.8615311   26.22090   25.610153 17.513825


# another example with non-flat priors

q <- dim(Y)[2];
p <- dim(X)[2]

Psi <- diag(q);
df <- 100;
Lambda <- matrix(1, p,q);
Omega <- diag(p);

Result <- lm.multivariable(100000,as.matrix(X),as.matrix(Y), 
                    Psi = Psi, Lambda = Lambda, Omega = Omega, df  = df)

apply(Result$B, c(1,2), quantile, probs = 0.025)

#        [,1]       [,2]        [,3]        [,4]       [,5]        [,6]
#[1,] -3.1928505  -8.7087715 -2.11412760 -68.732806  -72.2610310 -166.161629
#[2,] -7.7399911 -10.2949836  8.42781093  80.903187 -122.9516060 -439.061488
#[3,]  0.2967840   0.4875639 -1.94875624 -14.002509  -38.1540680  -68.836114
#[4,] -0.2478697  -0.8248859 -0.35554546  -5.876774   -8.7522043  -18.719224
#[5,] -0.6240758   5.9502911 -1.37365999  -6.013815   -0.3650527  -22.029445
#[6,]  0.4390190   0.1635907 -0.03878194  12.322521   -7.9037442   -7.009014
#[7,] -0.2132884  -2.5518965  0.32262252   4.047022    9.5924335   -5.558265
#[8,] -0.2416986   0.1492829 -0.10535331  -1.950555    3.1241892   -1.959921

apply(Result$B, c(1,2), quantile, probs = 0.975)
#          [,1]       [,2]        [,3]       [,4]       [,5]       [,6]
#[1,]  1.25240719  4.3437795  4.40159221  37.2050446  88.113983 164.779589
#[2,]  4.48834055 25.7113446 26.37246238 370.9277982 314.746238 468.296625
#[3,]  2.13431843  5.9123870  0.75306900  29.7107435  27.194862  67.113872
#[4,]  0.26236589  0.6702440  0.39139127   6.2383669   9.350772  18.846760
#[5,] -0.01903488  7.7322879 -0.48300731   8.3761728  21.298433  22.591135
#[6,]  0.63238785  0.7318222  0.24513427  16.8972440  -1.048465   7.191252
#[7,] -0.05346776 -2.0759189  0.55853126   7.8618069  15.293202   6.322247
#[8,] -0.19737469  0.2810081 -0.03992953  -0.8967174   4.718940   1.345393

# Likewise we can generate the intervals for V

apply(Result$V, c(1,2), quantile, probs = 0.025)
#        [,1]       [,2]       [,3]       [,4]        [,5]       [,6]
#[1,]   66.31403  -15.99174   45.90551   1673.776    606.2574   52.91293
#[2,]  -15.99174  513.26466   11.97599   2116.083   3091.9920   38.31070
#[3,]   45.90551   11.97599  130.44844   4085.743   2809.2265  129.13678
#[4,] 1673.77588 2116.08305 4085.74259 148829.299 104908.3877 4413.60517
#[5,]  606.25741 3091.99200 2809.22646 104908.388 103557.0541 3213.33767
#[6,]   52.91293   38.31070  129.13678   4413.605   3213.3377  161.18759
apply(Result$V, c(1,2), quantile, probs = 0.975)
#[,1]       [,2]        [,3]       [,4]        [,5]      [,6]
#[1,] 83.43571   17.50416   64.89681   2328.564   1101.211   74.27213
#[2,]   17.50416  644.69165   59.16379   3762.409   4546.990   91.26919
#[3,]   64.89681   59.16379  164.01904   5178.442   3651.908  164.50401
#[4,] 2328.56371 3762.40888 5178.44201 187052.989 134386.478 5612.54584
#[5,] 1101.21066 4546.99032 3651.90750 134386.478 130000.157 4156.87262
#[6,]   74.27213   91.26919  164.50401   5612.546   4156.873  202.46661

# Can also take a histogram to take a look a the distribution
# one example:

hist(Result$B[1,1,], breaks = 100, probability = TRUE)
